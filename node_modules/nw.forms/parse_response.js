// node.js

var url = require('url'),
    http = require('http'),
    querystring = require('querystring');

module.exports = function (obj, callback) { 
    if (!(obj instanceof http.IncomingMessage)) {
        return callback(null, obj);
    }

    if (obj.method === 'GET') {
        if (typeof obj.query !== 'undefined') {
            callback(null, obj.query);
        } else {
            callback(null, url.parse(obj.url));
        }
    } else if (obj.method === 'POST' || obj.method === 'PUT') {
        if (typeof obj.body !== 'undefined') {
            callback(null, obj.body);
        } else {
            var buffer = '';
            obj.addListener('data', function (chunk) {
                buffer += chunk;
            });
            obj.addListener('end', function () {
                callback(null, querystring.parse(buffer));
            });
        }
    } else {
        callback(new Error('Cannot handle request method: ' + obj.method));
    }
};
