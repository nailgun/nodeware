var path = require('path');

function Connection () {
    var connection = {};

    var data = {};

    connection.get = function (key, callback) {
        if (callback) {
            callback(data[key]);
        }
    };

    connection.set = function (key, value, callback) {
        data[key] = value;
        if (callback) {
            callback();
        }
    };

    connection.invalidate = function (key, callback) {
        delete data[key];
        if (callback) {
            callback();
        }
    };

    return connection;
};

module.exports = function (url, callback) {
    var prefix = '';
    if (url.host) {
        prefix = path.join(url.host, url.pathname);
    }
    callback(Connection(), prefix);
};