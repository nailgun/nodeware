function Connection () {
    var connection = {};

    var data = {};
    var expiresIn = {};

    connection.get = function (key, callback) {
        if (callback) {
            var expires = expiresIn[key];
            if (!expires || expires > new Date().getTime()) {
                callback(data[key]);
            } else {
                delete data[key];
                callback(undefined);
            }
        }
    };

    connection.set = function (key, value, expires, callback) {
        data[key] = value;
        if (expires) {
            expiresIn[key] = new Date().getTime() + expires;
        } else {
            expiresIn[key] = 0;
        }
        if (callback) {
            callback();
        }
    };

    connection.invalidate = function (key, callback) {
        delete data[key];
        delete expiresIn[key];
        if (callback) {
            callback();
        }
    };

    return connection;
};

module.exports = function (opts, callback) {
    callback(Connection());
};
