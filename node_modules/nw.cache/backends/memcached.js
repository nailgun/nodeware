var mc = require('mc'),
    path = require('path'),
    throws = require('nw.utils').throws;

function Connection (client) {
    var connection = {};

    connection.get = function (key, callback) {
        client.get(key, function (err, value) {
            if (err) {
                if (err.type === 'NOT_FOUND') {
                    return callback(undefined);
                } else {
                    throw err;
                }
            }
            callback(value[key]);
        });
    };

    connection.set = function (key, value, callback) {
        client.set(key, value, throws(callback));
    };

    connection.invalidate = function (key, callback) {
        client.del(key, throws(callback));
    };

    return connection;
};

module.exports = function (opts, callback) {
    var servers = opts.servers || opts.server;
    var client = new mc.Client(servers);
    client.connect(throws(function () {
        callback(Connection(client));
    }));
};
